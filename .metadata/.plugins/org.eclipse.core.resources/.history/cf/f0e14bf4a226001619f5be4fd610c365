package jammazwan;

import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

import org.apache.camel.Exchange;
import org.apache.camel.Processor;
import org.apache.camel.builder.RouteBuilder;
import org.apache.camel.component.jackson.JacksonDataFormat;
import org.apache.camel.component.jackson.ListJacksonDataFormat;
import org.apache.camel.model.DataFormatDefinition;
import org.apache.camel.model.language.JsonPathExpression;

import jammazwan.entity.XmplProject;

public class UnMarshalExampleProjects extends RouteBuilder {
	JsonPathExpression jsonPathExpression = new JsonPathExpression("$[*]");
	List<XmplProject> exampleProjects = new ArrayList<XmplProject>();
	Map<String, DataFormatDefinition> formats = new HashMap<String, DataFormatDefinition>();
	JacksonDataFormat floormat = new ListJacksonDataFormat();
	formats.put("xmplProjectFormat", floormat)
	

	@Override
	public void configure() throws Exception {
		
this.getContext().setDataFormats();
		from("file://src/main/resources?noop=true&fileName=xyzprojects.json").split(jsonPathExpression)
        .convertBodyTo(String.class)
				.process(new Processor() {
					@Override
					public void process(Exchange exchange) throws Exception {
						System.err.println("WHAT IS " + exchange.getIn().getBody());
					}
				});
		// .process(new Processor() {
		// @Override
		// public void process(Exchange exchange) throws Exception {
		// XmplProject xmplProject = exchange.getIn().getBody();
		// if(xmplProject==null){
		// System.err.println("DARN");
		// }
		// exampleProjects.add(xmplProject);
		// }
		// });
		// .unmarshal().json(JsonLibrary.Jackson, XmplProject.class).process(new
		// Processor() {
		// @Override
		// public void process(Exchange exchange) throws Exception {
		// System.err.println("WHAT IS " + exchange.getIn().getBody());
		// // Object obj = exchange.getIn().getBody();
		// // System.err.println("WHAT IS "+ obj.getClass());
		// // XmplProject xmplProject =
		// // exchange.getIn().getBody(XmplProject.class);
		// // exampleProjects.add(xmplProject);
		// // System.out.println("OOOOOOOOOO " + xmplProject);
		// }
		// });
	}

	public List<XmplProject> getExampleProjects() {
		return exampleProjects;
	}

}
